POP_LDFLAGS += -L$(top_builddir)/pop -lpop

TK_SOURCES = tokdump.cpp
TK_OBJECTS = $(addprefix $(builddir)/,$(TK_SOURCES:.cpp=.o))
TK_DEPENDS = $(addprefix $(builddir)/,$(TK_SOURCES:.cpp=.d))

AD_SOURCES = astdump.cpp
AD_OBJECTS = $(addprefix $(builddir)/,$(AD_SOURCES:.cpp=.o))
AD_DEPENDS = $(addprefix $(builddir)/,$(AD_SOURCES:.cpp=.d))

C_SOURCES = comp.cpp
C_OBJECTS = $(addprefix $(builddir)/,$(C_SOURCES:.cpp=.o))
C_DEPENDS = $(addprefix $(builddir)/,$(C_SOURCES:.cpp=.d))

CC_SOURCES = ccomp.cpp
CC_OBJECTS = $(addprefix $(builddir)/,$(CC_SOURCES:.cpp=.o))
CC_DEPENDS = $(addprefix $(builddir)/,$(CC_SOURCES:.cpp=.d))

DIS_SOURCES = dis.cpp
DIS_OBJECTS = $(addprefix $(builddir)/,$(DIS_SOURCES:.cpp=.o))
DIS_DEPENDS = $(addprefix $(builddir)/,$(DIS_SOURCES:.cpp=.d))

DEPENDS = $(TK_DEPENDS) $(AD_DEPENDS) \
          $(C_DEPENDS) $(CC_DEPENDS) $(DIS_DEPENDS)

all: poptok popast popc popcc popdis

clean:
	$(RM) *.[do] popast popc popcc popdis

poptok: $(TK_OBJECTS) $(top_builddir)/pop/libpop.so
	$(strip $(POP_CXXLD) $(POP_CXXFLAGS) -o $@ $(TK_OBJECTS) $(POP_LDFLAGS))

popast: $(AD_OBJECTS) $(top_builddir)/pop/libpop.so
	$(strip $(POP_CXXLD) $(POP_CXXFLAGS) -o $@ $(AD_OBJECTS) $(POP_LDFLAGS))

popc: $(C_OBJECTS) $(top_builddir)/pop/libpop.so
	$(strip $(POP_CXXLD) $(POP_CXXFLAGS) -o $@ $(C_OBJECTS) $(POP_LDFLAGS))

popcc: $(CC_OBJECTS) $(top_builddir)/pop/libpop.so
	$(strip $(POP_CXXLD) $(POP_CXXFLAGS) -o $@ $(CC_OBJECTS) $(POP_LDFLAGS))

popdis: $(DIS_OBJECTS) $(top_builddir)/pop/libpop.so
	$(strip $(POP_CXXLD) $(POP_CXXFLAGS) -o $@ $(DIS_OBJECTS) $(POP_LDFLAGS))

$(builddir)/%.o: $(srcdir)/%.cpp
	$(strip $(POP_CXX) $(POP_CXXFLAGS) -o $@ $<)

$(top_builddir)/pop/libpop.so:
	$(MAKE) -C $(top_builddir)/pop libpop.so
